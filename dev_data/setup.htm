<!DOCTYPE html>
<html>
 <head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="css/build.css">
  <!-- <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="css/style.css"> -->
  <script type="text/javascript" src="js/function.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Settings page</title>
  <script type="text/javascript">
   var set_real_time;
   function handleServerResponse(stage,jsonResponse){
    clearTimeout(set_real_time);
    var res = jsonResponse.time.split(":");
    real_time(hours=res[0],min=res[1],sec=res[2]);
    if (window.location.hash == '#wifi-connect') {
     html('title', ' ');
     toggle('dev-opt', 'show');
     toggle('dev-othe', 'show');
     toggle('wifi-connect1','hidden');
     toggle('first-restart', 'hidden');
    }
   }
   function real_time(hours,min,sec) {
    sec=Number(sec)+1;
    if (sec>=60){min=Number(min)+1;sec=0;}
    if (min>=60){hours=Number(hours)+1;min=0;}
    if (hours>=24){hours=0};
    html('time',hours+":"+min+":"+sec);
    set_real_time = setTimeout("real_time("+hours+","+min+","+sec+");", 1000);
   }
   function set_time_zone(submit){
    var set_date = new Date();
    var gmtHours = -set_date.getTimezoneOffset()/60;
    val('timeZone', gmtHours);
    send_request(submit,'/timeZone?timeZone='+gmtHours);
   }
   function set_ssid(submit){
    server = "/ssid?ssid="+val('ssid')+"&ssidPass="+encodeURIComponent(val('ssidPass'));
    send_request(submit,server);
    alert(jsonResponse.LangReset2);
   }
   function set_ssid_ap(submit){
    server = "/ssidap?ssidAP="+val('ssidap')+"&ssidApPass="+encodeURIComponent(val('ssidApPass'));
    send_request(submit,server);
    alert(jsonResponse.LangReset2);
   }
   function set_ssdp(submit){
    send_request(submit,'/ssdp?ssdp='+val('ssdp'));
    html('ssdp_t',val('ssdp'));
   }
   function ddns(submit){
    server = "/ddns?url="+encodeURIComponent(val('ddns'))+"&wanurl="+val("ddns-name")+"&wanport="+val("ddns-port");
    send_request(submit,server);
   }
   function first_restart(submit,texts){
    var LangConnect2 = jsonResponse.LangConnect2;
    var LangRedirect = '<small class="pull-right">'+jsonResponse.LangRedirect+' 15 '+jsonResponse.LangSec+'<\/small>';
    set_time_zone(this);
    if (confirm(texts)) {
     toggle('pop-up');
     var xmlHttp=createXmlHttpObject();
     xmlHttp.open("POST", "/restartWiFi", true);
     xmlHttp.send(null);
     xmlHttp.onload = function(e) {
      document.getElementById('url-ip').innerHTML = LangConnect2+' <h3><a href="http://'+xmlHttp.responseText+'">http://'+xmlHttp.responseText+'<\/a><\/h3>'+LangRedirect;
      setTimeout(function(){
       window.location.href = 'http://'+xmlHttp.responseText;
      }, 15000);
     }
    }
   }
  </script>
 </head>
 <body onload="load('first');">
  <div class="container">
   <div class="row hidden" id="content">
    <h1 id="title">{{LangSetting3}}</h1>
    <div class="col-sm-offset-2 col-sm-8 col-md-offset-3 col-md-6">
     <h5 class="alert-danger" id="ssdp_t">{{SSDP}}</h5>
     <div class="btn-group" id="language">
      <a href="#" class="btn btn-default dropdown-toggle" onclick="toggle('language-set');LoadLang('language-set');return false">{{lang}} <span class="caret"></span></a>
      <ul class="dropdown-menu hidden" id="language-set"><li><a href="#">{{LangLoading}}</a></li></ul>
     </div>
     <div id="dev-opt">
      <a class="btn btn-block btn-danger" href="/">{{LangDevices}}</a>
      <a class="btn btn-block btn-default" href="/device.htm">{{LangOptions1}}</a>
      <hr id="hide-hr1">
      <div class="alert alert-dismissible alert-info">
       {{LangSetting4}}
       <span id="hide" class="hidden">
        <b>{{LangSetting5}} <a href="https://github.com/tretyakovsa/jaluzi/tree/master/build" target="_blank">github</a></b>
        <form method="POST" action="/update" enctype="multipart/form-data">
         <div class="btn-group">
          <input type="file" class="btn btn-primary btn-xs" name="update" style="height:33px" accept=".bin">
          <input type="submit" class="btn btn-default btn-sm" value="Download" onclick="this.value='{{LangLoading}}';" style="height:33px">
         </div>
        </form>
       </span>
      </div>
     </div>
     <h2>{{LangDevice}}</h2>
     <input id="ssdp" value="{{SSDP}}" class="form-control" pattern="[0-9a-zA-Zа-яА-Я.\- ]{1,20}" placeholder="{{LangDevice}}">
     <input class="btn btn-block btn-success" value="{{LangSave}}" onclick="set_ssdp(this);" type="button">
     <hr id="wifi-connect">
     <div class="row hidden" id="pop-up">
      <div class="col-sm-offset-2 col-sm-8 pop-up">
       <h5 class="alert-warning">{{LangSearch1}}</h5>
       <div class="alert alert-dismissible alert-info" id="url-ip">
        <div class="loader"></div> {{LangConnect1}}
       </div>
      </div>
     </div>
     <div class="alert alert-dismissible alert-danger hidden" id="wifi-connect1">{{LangWiFi3}}</div>
     <h2>{{LangWiFi2}}</h2>
     <div class="btn-group btn-block" id="ssid-group">
      <a href="#" class="btn btn-default btn-block dropdown-toggle" onclick="toggle('ssid-select');LoadWifi('ssid-select');return false"><span id="ssid-name">{{ssid}}</span> <span class="caret"></span></a>
      <ul class="dropdown-menu hidden" id="ssid-select"><li><a href="#">{{LangLoading}}</a></li></ul>
     </div>
     <input id="ssid" value="{{ssid}}" class="form-control hidden" pattern=".{1,15}" placeholder="{{LangWiFi1}}">
     <input id="ssidPass" value="{{ssidPass}}" pattern=".{8,15}" onfocus="this.type='text'" type="password" class="form-control" placeholder="{{LangPass}}">
     <input class="btn btn-block btn-success" value="{{LangSave}}" onclick="set_ssid(this);" type="button">
     <hr>
     <div id="dev-othe">
      <h2>{{LangGMT1}}</h2>
      <input id="timeZone" value="{{timeZone}}" pattern="[0-9]{1,3}" class="form-control">
      <input class="btn btn-block btn-success" value="{{LangSave}}" onclick="send_request(this,'/timeZone?timeZone='+val('timeZone'));" type="button">
      <input class="btn btn-block btn-primary" value="{{LangGMT2}}" onclick="set_time_zone(this);" type="button">
      <h2>{{LangTime1}} <strong id="time">{{time}}</strong></h2>
      <input class="btn btn-block btn-primary" value="{{LangTime2}}" onclick="send_request(this,'/Time');" type="button">
      <hr>
      <h2>{{LangAP}}</h2>
      <div class="row">
       <div class="col-sm-6">
        <input id="ssidap" value="{{ssidAP}}" class="form-control" pattern=".{1,15}" placeholder="{{LangWiFi1}}">
        <input id="ssidApPass" value="{{ssidApPass}}" pattern=".{8,15}" onfocus="this.type='text'" type="password" class="form-control" placeholder="{{LangPass}}">
        <input class="btn btn-block btn-success" value="{{LangSave}}" onclick="set_ssid_ap(this);" type="button">
       </div>
       <div class="col-sm-6">
        <div class="alert alert-dismissible alert-warning">{{LangWiFi4}}</div>
       </div>
      </div>
      <hr>
      <h2>{{LangDdns1}}</h2>
      <div class="alert alert-dismissible alert-info">{{LangDdns2}}</div>
      <div class="input-group" style="width:100%">
       <input id="ddns-name" value="{{ddnsName}}" class="form-control" style="width:70%;display:inline" placeholder="Host name">
       <input id="ddns-port" value="{{ddnsPort}}" class="form-control" style="width:30%;display:inline" pattern="[0-9]{0,5}" placeholder="Host port">
      </div>
      <input id="ddns" value="{{ddns}}" class="form-control" pattern="http://.+" placeholder="Service URL">
      <input class="btn btn-block btn-success" value="{{LangSave}}" onclick="ddns(this);" type="button">
      <hr>
      <input class="btn btn-block btn-default" value="{{LangCookie}}" onclick="delAllCookies();" type="button">
      <input class="btn btn-block btn-warning" value="{{LangReset1}}" onclick="if(confirm('{{LangReset3}}')){send_request(this,'/restart?device=ok');}" type="button">
      <a class="btn btn-block btn-default" href="/device.htm">{{LangOptions1}}</a>
     </div>
     <input class="btn btn-block btn-warning hidden" id="first-restart" value="{{LangReset1}}" onclick="first_restart(this,'{{LangReset3}}');" type="button">
    </div>
   </div>
  </div>
 </body>
</html>
